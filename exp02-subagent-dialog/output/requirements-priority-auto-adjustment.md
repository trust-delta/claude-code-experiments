# TODOアプリ 優先度調整機能（自動・手動）要件定義書

作成日: 2025年11月28日
バージョン: 2.0
最終更新日: 2025年11月29日

---

## 1. 機能概要

本要件定義書では、TODOアプリにおける**優先度自動調整機能**と**優先度手動調整機能**の両方を定義する。

### 1.1 目的

#### 1.1.1 優先度自動調整機能の目的

ユーザーが忙しくて手動調整できないときのサポートを目的とし、期限が近づいたタスクの優先度を自動的に調整することで、重要なタスクの見落としを防ぐ。

#### 1.1.2 優先度手動調整機能の目的

ユーザーが自身の判断でタスクの優先度を柔軟に変更できる機能を提供し、状況に応じた適切な優先度管理を可能にする。また、変更履歴や理由を記録することで、後から判断の根拠を確認できるようにする。

### 1.2 基本方針

#### 1.2.1 自動調整の基本方針

**控えめな調整アプローチ**を採用する。明らかに優先度が変わるべき場合（期限接近時）のみ調整を行い、ユーザーの判断を尊重する。

#### 1.2.2 手動調整の基本方針

- **ユーザーの意思を最優先**する
- 誤操作を防ぐための確認機能を提供する
- 変更の透明性を確保するため、履歴とメモ機能を提供する

### 1.3 対象ユーザー

- 複数のタスクを管理しており、優先度の手動調整が追いつかないユーザー
- 期限管理のサポートが必要なユーザー
- 自身の判断で柔軟に優先度を調整したいユーザー
- 優先度変更の履歴を管理・確認したいユーザー

---

## 2. 機能要件

### 2.1 共通要件

#### 2.1.1 優先度レベル

システムは以下の3段階の優先度を扱う：

| 優先度 | 表示名 | 説明 |
|--------|--------|------|
| 高 | 高 | 緊急性の高いタスク |
| 中 | 中 | 通常の優先度のタスク |
| 低 | 低 | 緊急性の低いタスク |

### 2.2 優先度自動調整機能

#### 2.2.1 自動調整のトリガー条件

**期限接近**のみをトリガーとする。

##### 2.2.1.1 調整タイミング

- **リアルタイム方式**: 条件を満たした瞬間に優先度を調整する

##### 2.2.1.2 期限接近の定義

以下の2つの閾値を設定する：

| 閾値 | 期限までの残り時間 | 調整内容 |
|------|-------------------|----------|
| 閾値1 | 3日前（72時間前） | 「低」→「中」に変更 |
| 閾値2 | 24時間前 | 「中」→「高」に変更 |

#### 2.2.2 優先度調整ロジック

##### 2.2.2.1 調整対象の判定条件

以下の条件を**すべて**満たすタスクを調整対象とする：

1. 期限が設定されている
2. タスクが未完了である
3. 現在時刻が調整閾値を超えている
4. 現在の優先度が調整後の優先度より低い

##### 2.2.2.2 調整ルール

| 現在の優先度 | 期限までの残り時間 | 調整後の優先度 |
|--------------|-------------------|---------------|
| 低 | 3日以内 | 中 |
| 低 | 24時間以内 | 中（※1） |
| 中 | 24時間以内 | 高 |
| 高 | - | 調整なし |

※1: 「低」→「中」への調整は3日前の時点で実行されるため、24時間前の時点では既に「中」になっている想定

##### 2.2.2.3 調整の制約

- **既に「高」優先度のタスクは調整しない**（現状維持）
- 優先度の引き下げは行わない（上げるのみ）
- 期限が過ぎたタスクは調整対象外

#### 2.2.3 手動調整時の動作

ユーザーがタスクの優先度を手動で変更した場合：

- **自動調整を一時的に無効化**する
- 無効化期間: そのタスクの期限まで
- 期限到達後、次のタスクサイクルで自動調整が再び有効になる

#### 2.2.4 自動調整の記録

システムは以下の情報を記録する：

- 自動調整が行われた日時
- 自動調整フラグ
- 調整前の優先度
- 調整後の優先度
- 調整理由（期限接近など）

### 2.3 優先度手動調整機能

#### 2.3.1 UI/UX要件

##### 2.3.1.1 調整方法

ユーザーは**タスク一覧画面**で各タスクの優先度を直接変更できる。

##### 2.3.1.2 入力コンポーネント

優先度の変更には**ドロップダウンリスト**を使用する。

- 選択肢: 「高」「中」「低」
- 現在の優先度がデフォルトで選択された状態で表示
- リストから選択すると即座に確認ダイアログを表示

##### 2.3.1.3 視覚的フィードバック

- 期限までの残り時間を各タスクに表示
- 表示形式: 「残り X日 Y時間」または「残り X時間」
- 期限切れの場合: 「期限超過」と警告色で表示

#### 2.3.2 一括変更機能

##### 2.3.2.1 対象選択

- タスク一覧画面で複数のタスクを選択可能（チェックボックス）
- 選択されたタスクの数を画面上に表示（例: 「3件のタスクを選択中」）

##### 2.3.2.2 一括変更操作

- 一括変更ボタンをクリックすると、優先度選択ダイアログを表示
- 選択した優先度が全選択タスクに適用される
- 適用前に確認ダイアログを表示

##### 2.3.2.3 一括変更の制約

- 最大100件まで一括変更可能
- 100件を超える場合はエラーメッセージを表示

#### 2.3.3 確認ダイアログ

##### 2.3.3.1 表示タイミング

優先度変更を確定する前に、必ず確認ダイアログを表示する。

##### 2.3.3.2 ダイアログ内容

確認ダイアログには以下の情報を表示：

- タスク名（一括変更の場合は対象件数）
- 変更前の優先度
- 変更後の優先度
- 期限日時
- 変更理由入力欄（オプション）
- 「変更する」「キャンセル」ボタン

##### 2.3.3.3 ダイアログ例（単一タスク）

```
優先度を変更しますか?

タスク: 資料作成
変更: 中 → 高
期限: 2025年11月30日 18:00
残り時間: 1日 18時間

変更理由（任意）:
[_____________________________]

[変更する] [キャンセル]
```

##### 2.3.3.4 ダイアログ例（一括変更）

```
3件のタスクの優先度を一括変更しますか?

変更後の優先度: 高

変更理由（任意）:
[_____________________________]

[変更する] [キャンセル]
```

#### 2.3.4 変更履歴機能

##### 2.3.4.1 履歴の記録内容

各優先度変更について、以下の情報を記録する：

- 変更日時
- 変更者（ユーザーID/ユーザー名）
- 変更前の優先度
- 変更後の優先度
- 変更方法（手動/自動）
- 変更理由（ユーザーが入力した場合）
- 変更時の期限までの残り時間

##### 2.3.4.2 履歴の表示場所

**タスク詳細画面**内に「優先度変更履歴」セクションを設ける。

##### 2.3.4.3 履歴の表示形式

変更履歴は時系列の降順（新しい順）で表示する。

表示項目：
- 変更日時
- 変更者
- 変更内容（「中 → 高」など）
- 変更方法（「手動」「自動（期限接近）」など）
- 変更理由（記録されている場合）

##### 2.3.4.4 履歴表示例

```
【優先度変更履歴】

2025年11月29日 15:30
変更者: 田中太郎
変更: 中 → 高
方法: 手動
理由: クライアントからの要望で優先対応が必要になったため

2025年11月28日 09:00
変更者: システム
変更: 低 → 中
方法: 自動（期限3日前）
理由: 期限接近のため自動調整
```

##### 2.3.4.5 履歴の保持期間

- タスク完了後も履歴を保持
- 保持期間: タスク完了から1年間
- 1年経過後は自動的に削除

#### 2.3.5 変更理由・メモ機能

##### 2.3.5.1 入力仕様

- 変更理由の入力は任意（必須ではない）
- 最大文字数: 500文字
- 入力形式: 自由記述（テキストエリア）

##### 2.3.5.2 入力推奨ケース

以下の場合、システムが入力を推奨（ヒント表示）：

- 優先度を大幅に変更する場合（低→高など）
- 期限直前の変更
- 頻繁に変更するタスク

##### 2.3.5.3 メモの活用

記録された変更理由は以下の場面で活用：

- 変更履歴の確認時
- チームメンバーとの情報共有
- 過去の意思決定の振り返り

#### 2.3.6 自動調整との関係

##### 2.3.6.1 手動調整後の自動調整

手動で優先度を変更した場合：

- そのタスクの自動調整は**期限まで無効化**される
- 無効化状態は変更履歴に記録される
- 期限到達後、次のタスクサイクルで自動調整が再び有効になる

##### 2.3.6.2 無効化の通知

手動変更時、確認ダイアログに以下の情報を表示：

```
注意: 優先度を手動で変更すると、このタスクの
自動調整は期限まで無効化されます。
```

#### 2.3.7 期限までの残り時間表示

##### 2.3.7.1 表示場所

- タスク一覧画面の各タスク行
- タスク詳細画面
- 優先度変更の確認ダイアログ

##### 2.3.7.2 表示形式

| 残り時間 | 表示形式 | 表示色 |
|---------|---------|--------|
| 1時間以上 | 「残り X日 Y時間」 | 通常色 |
| 24時間以内 | 「残り X時間」 | 警告色（オレンジ） |
| 3時間以内 | 「残り X時間」 | 危険色（赤） |
| 期限超過 | 「期限超過（X日前）」 | 危険色（赤） |

##### 2.3.7.3 リアルタイム更新

- 残り時間は1分ごとに自動更新
- ページをリロードしなくても最新の情報を表示

### 2.4 通知機能

#### 2.4.1 自動調整時の通知

##### 2.4.1.1 通知タイミング

優先度が自動調整された際、**即座に**ユーザーに通知する。

##### 2.4.1.2 通知内容

通知には以下の情報を含める：

- タスク名
- 調整前の優先度
- 調整後の優先度
- 調整理由（例: "期限24時間前のため"）
- 期限日時

##### 2.4.1.3 通知形式

- アプリ内通知として表示
- 通知履歴として確認可能

##### 2.4.1.4 通知例

```
【優先度自動調整】
タスク「資料作成」の優先度が変更されました

変更: 中 → 高
理由: 期限24時間前のため
期限: 2025年11月29日 18:00
```

#### 2.4.2 手動調整時の通知

手動調整の場合は通知を行わない（ユーザー自身が操作しているため）。

ただし、以下の場合は確認メッセージを表示：

- 一括変更完了時: 「X件のタスクの優先度を変更しました」
- エラー発生時: 「優先度の変更に失敗しました」

### 2.5 設定・カスタマイズ機能

#### 2.5.1 必須設定項目

なし（初期設定で動作可能）

#### 2.5.2 オプション設定項目（将来拡張）

- 自動調整機能の有効/無効切り替え
- 調整閾値のカスタマイズ（3日前、24時間前の変更）
- 通知のオン/オフ
- 手動調整時の確認ダイアログの表示/非表示

---

## 3. 非機能要件

### 3.1 パフォーマンス

#### 3.1.1 自動調整のパフォーマンス

- タスク数が1000件の場合でも、調整判定は1秒以内に完了すること
- リアルタイム調整の遅延は最大5秒以内とすること

#### 3.1.2 手動調整のパフォーマンス

- 単一タスクの優先度変更は0.5秒以内に完了すること
- 一括変更（100件）は3秒以内に完了すること
- 変更履歴の読み込みは1秒以内に完了すること
- 残り時間の更新処理はUIの操作性に影響を与えないこと

### 3.2 可用性

- 自動調整機能の障害が発生しても、手動での優先度変更は可能であること
- 手動調整機能の障害が発生しても、自動調整は継続して動作すること
- 調整ロジックのエラーは適切にログに記録し、ユーザー体験に影響を与えないこと
- 変更履歴の記録に失敗しても、優先度変更自体は完了すること

### 3.3 保守性

- 調整ロジック（自動/手動）は独立したモジュールとして実装し、テストが容易であること
- 調整閾値（3日、24時間）は設定ファイルまたは定数として管理すること
- 確認ダイアログのテキストは外部ファイル（i18n対応）で管理すること
- 変更履歴のデータ構造は拡張可能な設計とすること

### 3.4 セキュリティ

- 調整処理（自動/手動）はユーザーごとに独立して実行されること
- 他ユーザーのタスクに影響を与えないこと
- 変更履歴の閲覧権限は適切に制御すること
- 変更理由に含まれる個人情報は適切に保護すること

### 3.5 データ整合性

- 優先度の調整履歴（自動/手動）を記録し、監査可能であること
- 調整処理中にタスクが削除された場合でもエラーが発生しないこと
- 複数のユーザーが同時に同じタスクを変更した場合、適切に排他制御を行うこと
- 一括変更の途中で失敗した場合、ロールバックまたは部分適用の明確な処理を行うこと

### 3.6 ユーザビリティ

#### 3.6.1 UI/UX品質

- 確認ダイアログは直感的でわかりやすいこと
- エラーメッセージは具体的な対処方法を示すこと
- 変更履歴は読みやすく整理されていること

#### 3.6.2 アクセシビリティ

- キーボード操作のみで全機能を利用可能であること
- スクリーンリーダーに対応すること
- 色覚多様性に配慮した配色を使用すること

---

## 4. 制約事項

### 4.1 技術的制約

#### 4.1.1 自動調整の制約

- リアルタイム調整は、アプリがバックグラウンドで動作している場合のみ実行される
- タイムゾーンはシステム設定に依存する（Asia/Tokyo固定ではない）

#### 4.1.2 手動調整の制約

- 一括変更は最大100件まで
- 変更履歴の表示は直近100件まで（それ以前は別途検索機能が必要）
- 変更理由の最大文字数は500文字
- 残り時間の更新間隔は最短1分

### 4.2 業務的制約

#### 4.2.1 自動調整の業務的制約

- 期限が設定されていないタスクは調整対象外
- 完了済みタスクは調整対象外

#### 4.2.2 手動調整の業務的制約

- 完了済みタスクの優先度は変更不可
- 削除予定のタスクの優先度は変更不可
- アーカイブされたタスクの優先度は変更不可

### 4.3 ユーザビリティ制約

#### 4.3.1 通知の制約

- 通知が過度に頻繁にならないよう、同一タスクの自動調整は最大1日1回まで
- 一度に大量のタスクが調整される場合、通知はまとめて表示する

#### 4.3.2 UI操作の制約

- モバイル端末での一括変更は最大20件まで（画面サイズの制約）
- 確認ダイアログは同時に1つまで表示
- 変更理由の入力フィールドは単一行表示の場合、自動的に展開しない

---

## 5. 将来の拡張可能性

### 5.1 優先度計算ロジックの拡張

現在は「期限までの残り時間」のみで判断しているが、将来的に以下の要素を考慮する可能性がある：

- タスクの重要度（ユーザー設定）
- タスクの所要時間（見積もり）
- タスクの依存関係
- 過去の完了パターン（機械学習による予測）
- ユーザーの手動調整パターンの学習

### 5.2 調整パターンの多様化

現在は「控えめな調整」のみだが、将来的に以下のモードを追加する可能性がある：

- **積極的モード**: より早い段階で優先度を上げる
- **カスタムモード**: ユーザーが調整ルールを自由に設定
- **チームモード**: チーム全体のタスク状況を考慮した調整

### 5.3 手動調整機能の拡張

#### 5.3.1 一括操作の強化

- フィルタ条件による一括変更（例: 「期限が今週のタスクを全て高に変更」）
- テンプレートを使った一括変更（よく使う変更パターンを保存）
- スケジュール設定による自動一括変更

#### 5.3.2 変更履歴の高度化

- 変更履歴のエクスポート（CSV、PDF）
- 変更パターンの可視化（グラフ表示）
- 変更の取り消し（Undo）機能
- 変更のやり直し（Redo）機能

#### 5.3.3 コラボレーション機能

- 他ユーザーへの変更通知
- 変更の承認フロー
- 変更理由へのコメント機能

### 5.4 通知機能の強化

- メール通知
- プッシュ通知（モバイルアプリ）
- 通知のグループ化・サマリー表示
- 通知の優先度設定
- 手動変更時の関係者への通知

### 5.5 分析機能の追加

#### 5.5.1 自動調整の分析

- 自動調整の効果測定（期限遅れの減少率など）
- 自動調整のトリガー頻度分析

#### 5.5.2 手動調整の分析

- ユーザーの優先度調整パターン分析
- 変更理由の傾向分析
- 最も優先度を変更されやすいタスクの特定
- 推奨される調整ルールの提案

#### 5.5.3 統合分析

- 自動調整と手動調整の比率分析
- 手動調整が自動調整を上書きする頻度
- 最適な調整閾値の提案

### 5.6 AI/機械学習の活用

- 変更理由の自動提案（過去の類似ケースから）
- 優先度変更の必要性の予測
- 最適な優先度の推奨

### 5.7 他機能との連携

- カレンダーアプリとの連携
- リマインダー機能との統合
- チーム管理機能との連携（他メンバーのタスク状況を考慮）
- プロジェクト管理ツールとの連携
- 時間管理ツール（タイムトラッキング）との連携

---

## 6. 用語定義

| 用語 | 定義 |
|------|------|
| 優先度 | タスクの重要度・緊急性を示す指標（高・中・低の3段階） |
| 優先度自動調整 | システムが自動的にタスクの優先度を変更する機能 |
| 優先度手動調整 | ユーザーが明示的にタスクの優先度を変更する操作 |
| 期限接近 | タスクの期限まで一定時間を切った状態 |
| 調整閾値 | 自動調整が発動する期限までの残り時間（3日前、24時間前） |
| リアルタイム調整 | 条件を満たした瞬間に優先度を変更する方式 |
| 自動調整の無効化 | 手動調整後、そのタスクに対して自動調整を一時的に停止すること |
| 一括変更 | 複数のタスクの優先度を同時に変更する操作 |
| 変更履歴 | 優先度の変更記録（日時、変更者、変更内容、理由など） |
| 変更理由 | 優先度を変更した理由を記録するユーザー入力のメモ |
| 確認ダイアログ | 優先度変更前に表示される確認用のポップアップ画面 |
| 残り時間表示 | タスクの期限までの残り時間をリアルタイムで表示する機能 |
| 排他制御 | 複数ユーザーが同時に同じタスクを変更する際の競合防止機能 |

---

## 7. 承認

| 役割 | 氏名 | 承認日 |
|------|------|--------|
| 要件定義者 | - | 2025年11月28日 |
| 要件追加（手動調整） | - | 2025年11月29日 |
| レビュアー | - | - |
| 承認者 | - | - |

---

## 8. 変更履歴

| バージョン | 変更日 | 変更内容 | 変更者 |
|-----------|--------|----------|--------|
| 1.0 | 2025年11月28日 | 初版作成（優先度自動調整機能） | - |
| 2.0 | 2025年11月29日 | 手動優先度調整機能の要件を追加。以下の主要変更を実施：<br>- ドキュメントタイトルを「優先度調整機能（自動・手動）」に変更<br>- 機能概要セクションに手動調整の目的・方針を追加<br>- 2.3節として手動調整機能の詳細要件を追加（UI/UX、一括変更、確認ダイアログ、変更履歴、変更理由・メモ、期限表示）<br>- 非機能要件に手動調整のパフォーマンス、ユーザビリティ、アクセシビリティ要件を追加<br>- 制約事項に手動調整の技術的・業務的制約を追加<br>- 将来の拡張可能性に手動調整機能の拡張案を追加<br>- 用語定義に手動調整関連の用語を追加 | - |

---

以上
