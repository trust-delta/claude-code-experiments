# 実験ガイド

Claude Code Experimentsで実験を計画・実施・分析するための包括的なガイドです。

**最終更新**: 2025年11月24日

## 📖 目次

1. [実験の進め方](#実験の進め方)
2. [実験設計のベストプラクティス](#実験設計のベストプラクティス)
3. [ログの記録方法](#ログの記録方法)
4. [分析の観点](#分析の観点)
5. [結果の共有](#結果の共有)

---

## 🔬 実験の進め方

### ステップ1: 実験の計画

#### 1.1 問いを明確にする

まず、何を明らかにしたいのかを明確にします：

- **良い例**: 「サブエージェントは対話的タスクに適しているか？」
- **悪い例**: 「サブエージェントを試してみる」

#### 1.2 仮説を立てる

予想される結果を事前に記述します：

```markdown
仮説: サブエージェントは対話的タスクに不向きで、
以下の理由により、メインセッションより効率が悪い：
1. コンテキストの分断
2. リアルタイムフィードバックの欠如
3. 中間修正の困難さ
```

#### 1.3 検証方法を設計する

仮説を検証するための具体的な方法を決めます：

- **比較対象**: 何と比較するか（例: メインセッション vs サブエージェント）
- **測定指標**: 何を測定するか（例: 所要時間、やり取り回数、成果物の品質）
- **実験パターン**: いくつのパターンを試すか

### ステップ2: 環境のセットアップ

1. **テンプレートをコピー**:
   ```bash
   cp -r experiments/template experiments/XX-your-experiment
   ```

2. **README.mdを編集**: 実験内容、仮説、手順を記載

3. **setup.mdを作成**: 環境構築手順を詳細に記述

4. **必要なツール/環境を準備**: Claude Code、サンプルコード、記録用ツールなど

### ステップ3: 実験の実施

#### 3.1 実験前チェックリスト

- [ ] 実験環境が正しくセットアップされている
- [ ] 記録用のファイル/ツールが準備できている
- [ ] 実験手順を理解している
- [ ] 環境情報（OS、バージョン等）を記録した

#### 3.2 実験中の記録

**リアルタイムで記録すべきこと**:

1. **タイムスタンプ**: 各ステップの開始・終了時刻
2. **対話内容**: Claude Codeとのやり取りをそのまま記録
3. **観察**: 気づいた点、違和感、予想外の挙動
4. **スクリーンショット**: 重要な画面やエラーメッセージ
5. **メトリクス**: 測定可能な数値データ

**記録フォーマット例**:

```markdown
### [10:30] パターンA開始

**プロンプト**:
> TODOアプリに優先度自動調整機能を追加したい。要件を定義してください。

**Claude Codeの応答**:
[応答内容]

**観察**:
- サブエージェントが起動された
- レスポンスまで約15秒

### [10:35] サブエージェント完了

**レポート内容**:
[内容]

**気づいた点**:
- 詳細な分析はできたが、追加質問ができない
- メインセッションで再度説明が必要
```

#### 3.3 実験中の注意点

- **一貫性**: すべてのパターンで同じタスクを使用
- **公平性**: パターン間で条件を揃える
- **客観性**: 主観的な評価も記録するが、可能な限り具体的に記述
- **柔軟性**: 予期しない発見があれば、追加で調査する

### ステップ4: 結果の分析

実験が完了したら、`analysis.md`に結果を記録します。

#### 4.1 データの整理

収集したデータを表やグラフで整理：

| パターン | 所要時間 | やり取り回数 | 成果物スコア |
|---------|---------|-------------|-------------|
| A       | 15分     | 3回         | 8/10        |
| B       | 12分     | 5回         | 9/10        |
| C       | 10分     | 4回         | 9/10        |

#### 4.2 仮説の検証

各仮説について、データに基づいて検証：

```markdown
### 仮説1: サブエージェントは対話的タスクに不向き

**結果**: ✅ 支持された

**根拠**:
- 所要時間が他のパターンより長い（15分 vs 10-12分）
- サブエージェント完了後、メインで追加質問が3回発生
- コンテキスト分断により、詳細な確認が困難

**考察**:
サブエージェントは独立コンテキストで動作するため、
対話的なフィードバックループが機能せず、
結果的に非効率となった。
```

#### 4.3 予想外の発見

仮説以外で気づいた点も記録：

```markdown
## 予想外の発見

### 発見1: サブエージェントの分析深度

サブエージェントは独立して動作するため、
メインセッションよりも深い分析を行う傾向があった。
対話的タスクには不向きだが、
大規模な分析タスクには適している可能性がある。
```

### ステップ5: 知見の文書化

#### 5.1 ベストプラクティスの抽出

実験から得られた推奨事項を明確に：

```markdown
## ベストプラクティス

### サブエージェントを使うべき場面
- 大規模コードベースの分析
- 複数ファイルにまたがる検索
- 時間のかかる自動化タスク

### サブエージェントを使うべきでない場面
- 対話的な要件定義
- 頻繁なフィードバックが必要なタスク
- ユーザーの意思決定が必要なタスク
```

#### 5.2 アンチパターンの記録

避けるべきパターンも明確に：

```markdown
## アンチパターン

### ❌ サブエージェントで対話的タスク
- 問題: コンテキスト分断により、追加質問が困難
- 代替案: メインセッションで対話的に進める
```

---

## 🎯 実験設計のベストプラクティス

### 明確な目的を持つ

- 「何を明らかにしたいか」を一文で表現できるようにする
- 実験の範囲を明確にする（何を含み、何を含まないか）

### 仮説駆動で進める

- 実験前に仮説を立てる
- 仮説が支持されるか棄却されるか、どちらでも価値がある

### 比較可能なデータを収集する

- 同じタスクを複数のパターンで実施
- 測定方法を統一する
- 可能な限り定量的なデータを収集

### 再現可能にする

- 他の人が同じ実験を再現できるよう、詳細に記録
- 環境情報、バージョン、手順をすべて文書化

### 小さく始める

- 最初は小規模な実験から始める
- 成功したら、より複雑な実験に拡張

---

## 📝 ログの記録方法

### 対話ログの記録

Claude Codeとの対話を忠実に記録します：

#### 記録フォーマット

```markdown
## 対話ログ

### [HH:MM] ユーザーの質問・指示

> [プロンプト内容]

### [HH:MM] Claude Codeの応答

[応答内容]

### [HH:MM] 観察・メモ

- [気づいた点]
- [予想外だった点]
```

#### 記録のヒント

- **タイムスタンプ**: 各やり取りの時刻を記録
- **完全性**: 編集せず、そのまま記録
- **コンテキスト**: 何を意図して質問したかも記録
- **結果**: 実行結果やエラーメッセージも含める

### 観察メモの記録

実験中に気づいた点を随時メモ：

```markdown
## 観察メモ

### 気づいた点
- サブエージェントの起動に約3秒かかった
- レスポンスが詳細で、予想より多くの情報が含まれていた

### 問題点
- 追加質問ができず、不明点が残った
- コンテキストをメインに伝える際、情報の一部が失われた

### 良かった点
- 深い分析が行われた
- 構造化された結果が得られた
```

### スクリーンショット

重要な画面やエラーは画像で保存：

```bash
# スクリーンショットを保存するディレクトリ
mkdir -p screenshots

# ファイル名に日時とパターンを含める
# 例: 2025-11-24_10-30_pattern-a_subagent-start.png
```

---

## 🔍 分析の観点

### 定量的分析

測定可能なデータの比較：

1. **効率性**
   - 所要時間
   - やり取り回数
   - トークン使用量（可能な場合）

2. **品質**
   - 成果物の完成度（チェックリストで評価）
   - エラー率
   - カバレッジ（要件の網羅性）

3. **リソース使用**
   - メモリ使用量
   - CPU使用率
   - ファイルアクセス回数

### 定性的分析

主観的な評価も重要：

1. **使いやすさ**
   - 直感的か
   - 学習コストは低いか
   - エラーメッセージは分かりやすいか

2. **柔軟性**
   - 修正対応がしやすいか
   - 方向転換が容易か
   - 予期しないケースに対応できるか

3. **ユーザー体験**
   - ストレスを感じるか
   - 対話が自然か
   - 期待に沿っているか

### 比較の視点

複数のパターンを比較する際の観点：

```markdown
## パターン比較

| 観点 | パターンA | パターンB | パターンC | 総評 |
|------|----------|----------|----------|------|
| 効率性 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | Cが最良 |
| 品質 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | Aが詳細 |
| 使いやすさ | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | Bが自然 |
```

---

## 🤝 結果の共有

### 実験レポートの構成

完了した実験は以下の構成で共有：

1. **README.md**: 実験の概要と主要な発見
2. **analysis.md**: 詳細な分析結果
3. **対話ログ**: 実験中の記録
4. **成果物**: 要件定義書、コードなど

### プルリクエストの作成

実験結果を共有する場合：

```bash
# ブランチを作成
git checkout -b experiment/01-subagent-dialog-tasks

# 実験結果をコミット
git add experiments/01-subagent-dialog-tasks
git commit -m "[EXP-01] Complete subagent dialog task experiment"

# プッシュ
git push origin experiment/01-subagent-dialog-tasks

# プルリクエストを作成
```

### レビューのポイント

実験結果をレビューする際の観点：

- [ ] 実験の目的は明確か
- [ ] 仮説は検証されているか
- [ ] データは十分か
- [ ] 分析は論理的か
- [ ] 知見は実践的か
- [ ] 再現可能か

---

## 📚 参考資料

### テンプレート

- [実験テンプレート](../experiments/template/)
- [実験インデックス](../experiments/README.md)

### 実験例

- [実験01: サブエージェントの対話的タスク挙動検証](../experiments/01-subagent-dialog-tasks/)

### 外部リンク

- [Claude Code 公式ドキュメント](https://docs.anthropic.com/en/docs/agents/claude-code)
- [実験計画法の基礎](https://en.wikipedia.org/wiki/Design_of_experiments)

---

## 💡 よくある質問

### Q1: 実験にどのくらい時間をかけるべきか？

**A**: 実験の規模によりますが、以下を目安に：
- 小規模実験: 1-2時間（セットアップ + 実施 + 分析）
- 中規模実験: 半日（複数パターンの比較）
- 大規模実験: 1-2日（複雑な検証、大量のデータ収集）

### Q2: 仮説が棄却されたらどうすべきか？

**A**: 仮説が棄却されることは失敗ではなく、重要な発見です。なぜ予想と異なったのかを分析し、新たな仮説を立ててください。

### Q3: 定性的な評価はどう記録すべきか？

**A**: 主観的な評価も重要です。「使いやすかった」ではなく、「どのような点が使いやすかったか」を具体的に記述してください。

### Q4: 実験中に予期しない挙動が発生したら？

**A**: すぐに記録してください。予期しない挙動こそ、最も価値のある発見になることがあります。必要であれば、追加の実験を計画してください。

### Q5: 他の人の実験を再現できない場合は？

**A**: 環境の違い、バージョンの違いなどが原因の可能性があります。setup.mdに記載された環境情報と自分の環境を比較し、差異を確認してください。

---

**ハッピー・エクスペリメンティング！** 🚀
