# 実験01: サブエージェントの対話的タスク挙動検証

**作成日**: 2025年11月24日
**更新日**: 2025年11月24日
**ステータス**: 準備中
**カテゴリ**: サブエージェント

## 📊 実験環境

- **Claude Code バージョン**: [実験時に記録]
- **OS**: Linux / macOS / Windows
- **Node.js バージョン**: [実験時に記録]
- **実験実施予定日**: 2025年11月下旬

## 🎯 実験の目的

サブエージェントが**対話的なタスク**（特に要件定義フェーズ）に適しているかを検証する。

**背景**:
- サブエージェントは独立したコンテキストで動作し、メインセッションと対話が分断される
- 対話的タスク（要件定義、仕様確認）では、ユーザーとの複数回のやり取りが必要
- サブエージェントの最適な使用場面を明確にする必要がある

**ゴール**:
- サブエージェントの対話特性を理解する
- どのようなタスクにサブエージェントが適しているか明確にする
- 代替アプローチ（メイン+スキル、メインのみ）との比較

## 💡 仮説

### 仮説1: サブエージェントは対話的タスクに不向き

**予想される結果**:
サブエージェントで対話的タスク（要件定義）を実行すると、以下の問題が発生する：
- ユーザーの追加質問や修正依頼に柔軟に対応できない
- サブエージェントが完了後、メインセッションで再度説明が必要になる
- コンテキストの分断により、情報のロスが発生する

**根拠**:
- サブエージェントは独立したコンテキストで動作する設計
- 一度起動すると、中間的なフィードバックを受け付けにくい
- 最終レポートでしか結果が返ってこない

### 仮説2: 対話的タスクはメインセッションが効率的

**予想される結果**:
メインセッション（スキル使用/非使用問わず）で対話的タスクを実行すると：
- ユーザーの質問にリアルタイムで応答できる
- 即座に修正や方向転換が可能
- 全体の対話フローが自然で効率的

**根拠**:
- メインセッションではユーザーとの双方向コミュニケーションが容易
- スキルを使用しても、対話の流れは維持される

### 仮説3: サブエージェントは非対話的な実行タスクに適している

**予想される結果**:
以下のような非対話的タスクではサブエージェントが有効：
- コードベース全体の検索・分析
- 既定の手順に従った実装作業
- 大量のファイルを扱う自動化タスク

**根拠**:
- これらのタスクは「指示を受けて実行し、結果を返す」という一方向的なフロー
- 中間的な確認やフィードバックが不要

## ✅ 検証項目

実験で検証する具体的な項目：

- [ ] **対話フローの効率性**: 各パターンで要件定義が完了するまでのやり取り回数と時間
- [ ] **コンテキスト分断の影響**: サブエージェントの結果をメインに伝える際の情報ロス
- [ ] **修正時の柔軟性**: 途中で要件変更や追加質問があった場合の対応のしやすさ
- [ ] **ユーザー体験**: どのパターンが最も自然で使いやすいか
- [ ] **最終成果物の品質**: 各パターンで作成された要件定義の完成度

## 🔬 実験手順

### タスク設定

**タスク**: TODOアプリに「優先度自動調整機能」を追加する際の要件定義

**要件定義で明確にすべき項目**:
1. 機能の目的とユーザーストーリー
2. 優先度の自動調整ロジック（どのような基準で調整するか）
3. ユーザーへの通知方法
4. UI/UXの考慮事項
5. エッジケースの処理

### パターンA: サブエージェント使用

**手順**:
1. メインセッションでサブエージェントを起動
2. タスク指示: 「TODOアプリの優先度自動調整機能の要件定義を行ってください」
3. サブエージェントからのレポートを受け取る
4. 不明点や追加質問がある場合の対応を観察
5. 最終的な要件定義書の完成度を評価

**記録すべきデータ**:
- サブエージェント起動から完了までの時間
- レポート受領後のメインセッションでのやり取り回数
- コンテキスト分断による情報ロスの有無
- 修正が必要だった場合の対応方法

### パターンB: メインセッション + スキル使用

**手順**:
1. メインセッションで要件定義スキルを呼び出す（スキルが利用可能な場合）
2. スキル内で対話的に要件定義を進める
3. 必要に応じて追加質問や修正を行う
4. 最終的な要件定義書の完成度を評価

**記録すべきデータ**:
- 要件定義開始から完了までの時間
- ユーザーとのやり取り回数
- 修正や追加質問への対応のスムーズさ

### パターンC: メインセッションのみ（スキルなし）

**手順**:
1. メインセッションで直接要件定義を依頼
2. 対話的に要件定義を進める
3. 必要に応じて追加質問や修正を行う
4. 最終的な要件定義書の完成度を評価

**記録すべきデータ**:
- 要件定義開始から完了までの時間
- ユーザーとのやり取り回数
- 修正や追加質問への対応のスムーズさ

### 実験の実施

各パターンをディレクトリに分けて実行：
- `pattern-a-subagent/`: パターンAの記録
- `pattern-b-main-skill/`: パターンBの記録
- `pattern-c-main-only/`: パターンCの記録

各ディレクトリに以下を保存：
- `transcript.md`: 対話のトランスクリプト
- `requirements.md`: 最終的な要件定義書
- `notes.md`: 観察メモ

## 📐 評価基準

実験結果を評価するための基準：

| 評価項目 | 測定方法 | 成功基準 |
|---------|---------|---------|
| 対話の効率性 | やり取り回数と所要時間 | 少ないやり取りで高品質な成果物 |
| 柔軟性 | 修正対応のしやすさ（主観評価） | 即座に修正・追加対応が可能 |
| コンテキスト保持 | 情報ロスの有無（主観評価） | コンテキスト分断による情報ロスがない |
| ユーザー体験 | 自然さ・使いやすさ（主観評価） | 対話が自然で直感的 |
| 成果物の品質 | 要件定義の完成度（チェックリスト） | 全5項目が明確に定義されている |

## 📊 結果

詳細な分析結果は [analysis.md](analysis.md) を参照。

**実験完了後に記載**

## 🔍 得られた知見

**実験完了後に記載**

## 🚧 課題と今後の展開

### 次の実験候補

- **実験02**: サブエージェントの並列実行パターンの検証
- **実験03**: スキルとサブエージェントの組み合わせパターンの検証
- **実験04**: 大規模コードベース検索タスクでのサブエージェント効果測定

## 📎 関連資料

- [Claude Code 公式ドキュメント - Sub-agents](https://docs.anthropic.com/en/docs/agents/claude-code)
- [実験ガイド](../../docs/experiment-guide.md)
