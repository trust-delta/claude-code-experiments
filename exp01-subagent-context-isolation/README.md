# 実験01: サブエージェントのコンテキスト分離レベルの確認

## 実験環境

- **実験日**: 2025-11-21
- **Claude モデル**: claude-sonnet-4-5-20250929

## 目的

Claude Codeのサブエージェントは「メイン会話とは別の独立したコンテキストウィンドウを使用する」とドキュメントに記載されているが、実際にどの程度分離されているのかを検証する

## 仮説

サブエージェントの実行内容は完全にメインから隔離されている
- メインはサブエージェントの実行過程を知らない
- UI上に表示されている情報でもメインは認識できない可能性
- 再起動後にサブエージェントのログが消える可能性

## タスク

ランダム文字列を生成し、その文字列をファイル名として保存する
- サブエージェントには「実験が完了しました」とだけ報告させる
- 生成した文字列の詳細は報告しない

## 検証方法

1. **サブエージェントの実行**
   - experimentサブエージェントを起動
   - ランダム文字列生成とファイル作成を実行
   - UI上には実行ログが表示される（緑色の〇）

2. **メインへの質問**
   - 「サブエージェントが確認した文字列は分かりますか？」
   - **重要**: 「検索等は行わずに確認してください」と制約
   - メインが会話履歴のみから回答していることを確認

3. **再起動後の挙動確認**
   - IDE/Claude Codeを再起動
   - サブエージェントの実行ログがどうなるか観察

## 結果

詳細な分析結果は [analysis.md](./analysis.md) を参照してください。

### 主な発見

1. **メインはサブエージェントの出力のみを知る**
   - UI上に `FkpGuBiN1kJ9y2LZG` という文字列が表示されているのに
   - メインは「わかりません」と回答
   - サブエージェントからの報告は「実験が完了しました」のみ

2. **サブエージェント実行ログは再起動後に消える**
   - 緑色の〇（サブエージェントのログ）は全て消える
   - 白色の〇（メインのログ）のみ残る
   - ユーザーも後から実行内容を確認できない

3. **UI表示 ≠ Claude Codeが認識している情報**
   - 画面に表示されていても認識されるわけではない
   - サブエージェントの実行ログは会話履歴に保存されない

### サブエージェント実行ログの特徴

- ✅ 実行時にユーザーは何が起きているか確認できる
- ✅ 視覚的に区別される（緑色の〇）
- ❌ メインエージェントのコンテキストには含まれない
- ❌ 再起動後に消える（会話履歴に保存されない）
- ✅ メインはサブエージェントが返した最終出力のみを受け取る

### 非公開情報

以下は個人情報保護のため非公開：
- 完全な会話ログ (conversation-log.md)
- スクリーンショット (screenshots/)